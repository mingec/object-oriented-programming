---
title: 数据库笔记
date: 2023-12-20 17:04:39
tags:
categories: 
---
# 数据库笔记

## ch1 concept
1. 启动数据库：管理员身份打开cmd；

   ```
   net start/stop mysql80
   ```

2. 客户端连接：client。客户端操作dbms 在数据库中进行操作
3. 关系型数据库：由多张二维表构成的数据库

## ch2 sql

### DDL 数据定义语言

#### 数据库操作

#### 表操作

```
show databases;
creat database [if not exists] name [default charset 字符集（uft8mb4)][collate排序规则];
select databases();//查看当前数据库
drop database [if exists]name;//delete
use name //使用数据库
```
```
show tables;
desc table's_name；
//创建表  需要在某个数据库内进行操作
creat table name(
	id int comment '工号',
	name varchar(10) comment '姓名',
	idcard char(18) comment '身份证',
	entrydate date comment 'riqi',
	age tinyint unsigned commit '年龄'
)comment '注意变量类型！';
```



数据类型

给表增加字段：

```
alter table 表名 add 字段名 类型（长度）[comment '注释'];
```

修改数据类型：

```
alter table 表名 modify 字段名 新数据类型（长度）;
```

修改字段名和字段类型

```
alter table 表名 change 旧字段名 新字段名 类型（长度） [comment ''][约束];
```

删除字段

```
alter table 表名 drop 字段名;
```

修改表名

```
alter table 表名 rename to 新表名;
```

删除表

```
drop table [if exists] 表名;
```

```
truncate table 表名;
```

###  DML数据操作语言

进行增删改操作 

#### insert插入

给指定字段添加数据

~~~
insert into 表名（字段1,字段2...） values (值1,值2...);
//eg:
insert into user (name,age) values ('Nick',19);
~~~

给全部字段添加数据

~~~
insert into 表名 values (值1,值2,...);
~~~

~~~
insert into 表名 values (值1...),(值2...);//批量插入
~~~

#### update修改

~~~
update 表名 set 字段名1=值1 , 字段名2=值2 [where 条件]
~~~

####　删除

~~~
delete from 表名　where 
~~~

### DQL数据查询语言

data query language

关键字：select /from /where /group by /having /order by/limit

#### 基本查询

1. 查询返回多个字段

   ~~~
   select 字段1,字段2,...from 表名//是指，表中可能每个对象有多个字段，选择其中的字段
   ~~~

   ~~~
   select *from 表名 //全部字段
   ~~~

2. 设置别名 

   ~~~
   select ziduanming as 'bieming' from biaoming;
   ~~~

3. 去除重复

   ~~~
   select distinct ziduanming from biaoming;
   ~~~

#### 条件查询

~~~
select 字段列表 from 表名 where 条件列表
~~~

#### 聚合函数

~~~
select count(*) from 表名
select avg(age) from emp;
//max min sum 加 (字段);
~~~

####　分组查询

#### 排序查询

#### 分页查询



### DCL数据控制语言

#### 管理用户

1. ~~~
   use mysql;
   select * from user;
   ~~~

2. 创建用户

   ~~~
   create user '用户名'@'主机名' identified by 'password';
   // % 代表任意主机都能登录
   ~~~

3. 修改用户密码

   ~~~
   alter user 'username'@'hostname' identified with mysql_native_password by 'password';
   ~~~

4. 删除用户

   ~~~
   drop user 'username'@'hosename';
   ~~~

#### 管理权限

1. 查询权限

   ~~~
   show grants for 'heima'@'%';
   ~~~

2. 授予权限

   ~~~
   grants 权限列表 on 数据库名.表名 to '用户名'@'主机名';
   ~~~

3. 撤销权限

   ~~~
   remove qxlb on d.t from 'username'@'hostname';
   ~~~

4. ......



## ch3 函数

一段可以直接被另一端程序调用的程序或代码；

~~~
select 函数(参数)
~~~

#### 字符串函数

~~~
//eg 把所有员工id前面补0到5位
update emp set id = lpad(workno, 5 ,'0');
~~~

#### 数值函数

返回值是数字

~~~
eg 生成一个6位数随机验证码
select lpad(round(rand()*1000000,0),6,'0');
~~~

#### 日期函数

| 函数                                 | 功能                                              |
| ------------------------------------ | ------------------------------------------------- |
| curdate()/curtime()/now()            | 返回当前日期/时间/日期和时间                      |
| year(date) / month(date) / day(date) | 获取指定date的年月日                              |
| date_add(date,interval expr type)    | 返回一个日期/时间值加上一个时间间隔expr后的时间值 |
| datediff(date1,date2)                | 返回之间的天数                                    |

#### 流程控制函数

......



## ch4 约束

#### 根据约束创建表结构

~~~
create table user(
	id int primary key auto_increment comment '主键 自增',
	name varchar(10) not null unique comment 'name',
	age int check (age > 0 && age <=120) comment 'nianling'
)comment '用户';
~~~

#### 外键约束

外键（子表） 主键（父表）

1. 添加外键

   ~~~
   create table 表名(
   	字段 数据类型，
   	...
   	[constraint][外键名称]foreign key(外键字段名)references 主表(主表列名)
   );
   ~~~

   ~~~
   alter table 表名 add constraint 外键名称 foreign key (外键字段名) references 主表(主表列名);
   ~~~

2. 删除外键

   ~~~
   alter table 表名 drop foreign key 外键名称;
   ~~~



## ch5 多表查询

多对多：中间表

1. 隐式内连接

	~~~
	select * from table1,table2 where table1.test = table2.test
	~~~

	where消除笛卡尔积

	别名

	~~~
select e.name,d.name from emp e,dept d where e.dept_id=d.id;
	~~~
	
2. 显式内连接

   ~~~
   select * from emp e inner join dept d on e.dept_id = d.id;
   select e.name,d.name from emp e inner join dept d on e.dept_id = d.id;
   //on后面是条件 相当于where
   ~~~

3. 外连接

   ~~~
   //左外连接
   select 字段列表 from 表1 left outer join 表2 on 条件
   //eg: emp dept
   //    emp.dept_id=dept_id
   select e.*,d.name from emp e left outer join dept d on e.dept_id=d.id;
   //右外连接
   ~~~
   
4. 自连接

   ~~~
   //eg:在员工这张表中，managerid这个字段记录了员工的直属领导的id；
   select a.name,b.name from emp a,emp b where a.managerid=b.id;
   //a的managerid等于b（即领导表）的id
   //必须有别名
   //可以是内连接 也可以是外连接
   ~~~

5. ~~~
   select a.name '员工',b.name '领导' from emp a left join emp b on a.managerid=b.id;
   ~~~

6. 联合查询
	~~~
   //查出工资低于5000和年龄大于50的人
   select * from emp where salary<5000
   union all
   select * from emp where age>50;
   //将union all改为union，可去除重复的
   //字段类型需要一致
   ~~~
   
7. 子查询

   嵌套select
   
   ~~~
   select * from t1 where column1 = (select column1 from t2)
   ~~~
   
   标量子查询
   
   ~~~
   //eg：要查询销售部的所有员工信息，需要先查询销售部的部门id，再根据部门id查询员工id
   select * from emp where dept_id = (select id from dept where name = '销售部');
   //只有一个信息 子查询的返回值是一个标量
   ~~~
   
   列子查询
   
   ~~~
   select * from emp where dept_id in (select id from dept where name = '销售部' or name = '市场部');
   
   对列的操作：all in or any
   ~~~
   
   行子查询
   
   ~~~
   in , not in
   一行多列
   ~~~
   
   表子查询
   
   ~~~sql
   子查询返回的结果是多行多列
   select * from emp where (job,salary) in (select job, salary from emp where name = '鹿杖客' or name = '宋远桥');
   ~~~
   



## ch6 事务

一组操作的集合，不可分割

1. 操作

   ~~~
   set @@autocommit = 0;//手动提交
   select @@autocommit;
   commit;//提交
   rollback;//回滚
   ~~~

   ~~~
   start transaction;//自动commit或rollback
   ~~~

2. 四个特性

   原子性 一致性 隔离性 持久性

3. 并发事务问题

   |    隔离级别     | 脏读 | 不可重复读 | 幻读 |
   | :-------------: | ---- | ---------- | ---- |
   | read uncommited | y    | y          | y    |
   |  read commited  | n    | y          | y    |
   | repeatable read | n    | n          | y    |
   |  serializable   | n    | n          | n    |

4. 事务隔离级别

   ~~~
   select@@transaction_isolation
   ~~~

   ~~~
   set [session|global] transaction isolation level {read uncommitted|read commited|repeatable read|serializable}
   ~~~



## ch7 视图

#### 创建视图

~~~
create or replace view 名称 as select id,name where id<=10;
~~~

#### 查询视图

~~~
show create view 名称;
select * from 名称 where;
~~~

#### 修改

~~~
alter view 视图名称[(列表名称)] as select 语句
~~~

#### 删除

~~~
drop view 名称
~~~



## ch8 索引

